<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <title>Elsparkesykkel Wheelie-spill</title>
  <style>
    body {
      margin: 0;
      background: #222;
      color: #eee;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    canvas {
      background: linear-gradient(#87ceeb 0 60%, #444 60% 100%);
      border: 2px solid #555;
      margin-top: 10px;
    }
    #info {
      margin-top: 10px;
      text-align: center;
      line-height: 1.4;
    }
    .highlight {
      color: #ffd54f;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Elsparkesykkel Wheelie</h1>
  <div id="info">
    <div><span class="highlight">Mål:</span> Gjør en så lang wheelie som mulig!</div>
    <div><span class="highlight">Styring:</span> D = dra opp, A = brems, W = stå på én fot</div>
    <div>Wheelie-lengde: <span id="current">0.00</span> m &nbsp;|&nbsp; Rekord: <span id="best">0.00</span> m</div>
    <div>Stilpoeng: <span id="style">0</span></div>
    <div id="status"></div>
  </div>

  <canvas id="game" width="900" height="400"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const currentEl = document.getElementById("current");
    const bestEl = document.getElementById("best");
    const styleEl = document.getElementById("style");
    const statusEl = document.getElementById("status");

    const groundY = canvas.height * 0.65;
    const wheelRadius = 18;
    const scooterLength = 120;

    let baseX = 200;
    let baseY = groundY - wheelRadius;

    let angle = 0;
    let angularVelocity = 0;
    let angularAcceleration = 0;

    const gravityTorque = 0.001;
    const liftTorque = 0.003;
    const brakeTorque = 0.0025;
    const damping = 0.985;

    const maxSafeAngle = Math.PI / 3;
    const minSafeAngle = -Math.PI / 12;

    let keys = { a: false, d: false, w: false };

    let distance = 0;
    let bestDistance = 0;
    let stylePoints = 0;
    let inWheelie = false;
    let crashed = false;

    let lastTime = null;

    function resetRun() {
      angle = 0;
      angularVelocity = 0;
      angularAcceleration = 0;
      distance = 0;
      stylePoints = 0;
      inWheelie = false;
      crashed = false;
      statusEl.textContent = "Ny runde! Trykk D for å starte wheelie.";
    }

    resetRun();

    // Tastaturkontroll med event.code (fungerer på alle tastaturer)
    window.addEventListener("keydown", (e) => {
      if (e.code === "KeyA") keys.a = true;
      if (e.code === "KeyD") keys.d = true;
      if (e.code === "KeyW") keys.w = true;

      if (crashed && (e.code === "KeyA" || e.code === "KeyD" || e.code === "KeyW")) {
        resetRun();
      }
    });

    window.addEventListener("keyup", (e) => {
      if (e.code === "KeyA") keys.a = false;
      if (e.code === "KeyD") keys.d = false;
      if (e.code === "KeyW") keys.w = false;
    });

    function update(dt) {
      if (crashed) return;

      // Tyngdekraft
      const gravityDir = angle > 0 ? -1 : 1;
      angularAcceleration = gravityDir * gravityTorque;

      if (keys.d) angularAcceleration += liftTorque;
      if (keys.a) angularAcceleration -= brakeTorque;

      angularVelocity += angularAcceleration * dt;
      angularVelocity *= damping;
      angle += angularVelocity * dt;

      // Sjekk krasj
      if (angle > maxSafeAngle || angle < minSafeAngle) {
        crashed = true;
        inWheelie = false;
        statusEl.textContent = "Krasj! Trykk A, D eller W for å starte på nytt.";
        if (distance > bestDistance) bestDistance = distance;
        return;
      }

      // Wheelie
      const wheelieNow = angle > 0.05;

      if (wheelieNow) {
        if (!inWheelie) {
          inWheelie = true;
          distance = 0;
          stylePoints = 0;
          statusEl.textContent = "Wheelie! Hold balansen.";
        }
        distance += 4 * dt;
        if (keys.w) stylePoints += dt * 10;
      } else {
        if (inWheelie) {
          inWheelie = false;
          if (distance > bestDistance) bestDistance = distance;
          statusEl.textContent = "Wheelie avsluttet. Trykk D for ny wheelie.";
        }
      }

      currentEl.textContent = distance.toFixed(2);
      bestEl.textContent = bestDistance.toFixed(2);
      styleEl.textContent = Math.floor(stylePoints);
    }

    function drawScooter() {
      ctx.save();
      ctx.translate(baseX, baseY);

      // Bakre hjul
      ctx.fillStyle = "#111";
      ctx.beginPath();
      ctx.arc(0, 0, wheelRadius, 0, Math.PI * 2);
      ctx.fill();

      // Forhjul
      const frontX = scooterLength * Math.cos(angle);
      const frontY = -scooterLength * Math.sin(angle);

      ctx.beginPath();
      ctx.arc(frontX, frontY, wheelRadius, 0, Math.PI * 2);
      ctx.fill();

      // Deck
      ctx.strokeStyle = "#ddd";
      ctx.lineWidth = 20;
      ctx.lineCap = "round";
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(frontX, frontY);
      ctx.stroke();

      // Styre
      const handleLength = 50;
      const handleAngle = angle + Math.PI / 2;
      const hx = frontX - 10 * Math.cos(angle);
      const hy = frontY + 10 * Math.sin(angle);

      ctx.strokeStyle = "#ccc";
      ctx.lineWidth = 6;
      ctx.beginPath();
      ctx.moveTo(hx, hy);
      ctx.lineTo(hx + handleLength * Math.cos(handleAngle),
                 hy + handleLength * Math.sin(handleAngle));
      ctx.stroke();

      // Person
      const px = hx + handleLength * Math.cos(handleAngle);
      const py = hy + handleLength * Math.sin(handleAngle);

      // Kropp
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 5;
      ctx.beginPath();
      ctx.moveTo(px, py);
      ctx.lineTo(px, py - 40);
      ctx.stroke();

      // Hode
      ctx.beginPath();
      ctx.arc(px, py - 55, 10, 0, Math.PI * 2);
      ctx.fillStyle = "#f5d7b2";
      ctx.fill();

      // Ben
      ctx.beginPath();
      if (keys.w && inWheelie) {
        ctx.moveTo(px, py - 10);
        ctx.lineTo(px - 10, py + 15);
        ctx.moveTo(px, py - 10);
        ctx.lineTo(px + 5, py - 25);
      } else {
        ctx.moveTo(px, py - 10);
        ctx.lineTo(px - 8, py + 20);
        ctx.moveTo(px, py - 10);
        ctx.lineTo(px + 8, py + 20);
      }
      ctx.stroke();

      // Armer
      ctx.beginPath();
      ctx.moveTo(px, py - 30);
      ctx.lineTo(px - 15, py - 10);
      ctx.moveTo(px, py - 30);
      ctx.lineTo(px + 15, py - 10);
      ctx.stroke();

      ctx.restore();
    }

    function drawGround() {
      ctx.fillStyle = "#333";
      ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

      ctx.strokeStyle = "#bbb";
      ctx.lineWidth = 3;
      ctx.setLineDash([20, 20]);
      ctx.beginPath();
      ctx.moveTo(0, groundY + 20);
      ctx.lineTo(canvas.width, groundY + 20);
      ctx.stroke();
      ctx.setLineDash([]);
    }

    function loop(timestamp) {
      if (!lastTime) lastTime = timestamp;
      const dt = (timestamp - lastTime) / 1000;
      lastTime = timestamp;

      update(dt);

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawGround();
      drawScooter();

      requestAnimationFrame(loop);
    }

    requestAnimationFrame(loop);
  </script>
</body>
</html>
