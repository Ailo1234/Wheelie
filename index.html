const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// "Fysikk"
let angle = -0.2;        // vinkel på sparkesykkelen (negativ = litt opp)
let angularVelocity = 0; // hvor fort vinkelen endrer seg
let gravity = 0.0015;    // "tyngdekraft" som drar fronten ned
let controlForce = 0.003;// hvor mye spilleren kan påvirke
let isUpPressed = false;
let isDownPressed = false;

let distance = 0;
let gameOver = false;

document.addEventListener("keydown", (e) => {
  if (e.key === "ArrowUp" || e.key === "w") isUpPressed = true;
  if (e.key === "ArrowDown" || e.key === "s") isDownPressed = true;
});

document.addEventListener("keyup", (e) => {
  if (e.key === "ArrowUp" || e.key === "w") isUpPressed = false;
  if (e.key === "ArrowDown" || e.key === "s") isDownPressed = false;
});

function update(dt) {
  if (gameOver) return;

  // Tyngdekraft drar fronten ned (vinkelen mot 0 og videre)
  angularVelocity += gravity * dt;

  // Spillerkontroll
  if (isUpPressed) {
    angularVelocity -= controlForce * dt;
  }
  if (isDownPressed) {
    angularVelocity += controlForce * dt;
  }

  angle += angularVelocity * dt;

  // Sjekk om du tipper for langt
  const maxBack = -1.0; // for langt bakover
  const maxForward = 0.4; // for langt fremover

  if (angle < maxBack || angle > maxForward) {
    gameOver = true;
  } else {
    distance += 0.01 * dt; // du "kjører" fremover så lenge du balanserer
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Bakgrunn / "vei"
  ctx.fillStyle = "#444";
  ctx.fillRect(0, 300, canvas.width, 100);

  // Tegn sparkesykkel
  const baseX = 200;
  const baseY = 300;

  ctx.save();
  ctx.translate(baseX, baseY);
  ctx.rotate(angle);

  // Bakhjul
  ctx.fillStyle = "#000";
  ctx.beginPath();
  ctx.arc(-40, 0, 20, 0, Math.PI * 2);
  ctx.fill();

  // Framhjul
  ctx.beginPath();
  ctx.arc(40, 0, 20, 0, Math.PI * 2);
  ctx.fill();

  // Brett
  ctx.strokeStyle = "#ddd";
  ctx.lineWidth = 6;
  ctx.beginPath();
  ctx.moveTo(-40, 0);
  ctx.lineTo(40, 0);
  ctx.stroke();

  // Styre
  ctx.beginPath();
  ctx.moveTo(40, 0);
  ctx.lineTo(40, -50);
  ctx.stroke();

  ctx.restore();

  // Tekst
  ctx.fillStyle = "#fff";
  ctx.font = "20px sans-serif";
  ctx.fillText("Distanse: " + distance.toFixed(1) + " m", 20, 30);

  if (gameOver) {
    ctx.fillStyle = "red";
    ctx.font = "40px sans-serif";
    ctx.fillText("Game Over!", canvas.width / 2 - 100, 80);
  }
}

let lastTime = performance.now();
function loop(timestamp) {
  const dt = timestamp - lastTime;
  lastTime = timestamp;

  update(dt);
  draw();

  requestAnimationFrame(loop);
}

requestAnimationFrame(loop);
